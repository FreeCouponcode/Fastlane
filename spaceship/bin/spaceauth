#!/usr/bin/env ruby
$LOAD_PATH.push File.expand_path("../../lib", __FILE__)
require "colored"

# First we have to check if the user has `pry` installed
# We don't want to add pry as a spaceship dependency, as
# it shouldn't really be added to production systems

require "spaceship"
require "credentials_manager"

username = ARGV[1] if ARGV[0] == '-u'
username ||= CredentialsManager::AppfileConfig.try_fetch_value(:apple_id)
username ||= ask("Username: ")

begin
  puts "Logging into to iTunes Connect (#{username})..."
  Spaceship::Tunes.login(username)
  puts "Successfully logged in to iTunes Connect".green
  puts ""
rescue
  puts "Could not login to iTunes Connect...".red
end
begin
  puts "Logging into the Developer Portal (#{username})..."
  Spaceship::Portal.login(username)
  puts "Successfully logged in to the Developer Portal".green
  puts ""
rescue
  puts "Could not login to the Developer Portal...".red
end

puts ""
puts "-"
puts ""

itc_cookie_path = Spaceship::Tunes.client.persistent_cookie_path
itc_cookie_content = File.read(itc_cookie_path)
puts itc_cookie_content
