#!/usr/bin/env ruby
$LOAD_PATH.push File.expand_path("../../lib", __FILE__)

unless ENV['BUNDLE_BIN_PATH']
  has_gemfile = File.exist?('Gemfile') && File.read('Gemfile').include?('fastlane')

  require 'tmpdir'
  temp_gemfile = File.join(Dir.tmpdir, 'Gemfile')
  File.write(temp_gemfile, "gem 'fastlane'") unless has_gemfile

  command = "bundle exec fastlane #{ARGV.join(' ')}"
  command = "BUNDLE_GEMFILE=#{temp_gemfile} #{command}" unless has_gemfile
  system(command)
  status = $?

  unless has_gemfile
    File.delete(temp_gemfile)
    File.delete("#{temp_gemfile}.lock")
  end

  exit(status.exitstatus)
end

require "fastlane/cli_tools_distributor"
Fastlane::CLIToolsDistributor.take_off
